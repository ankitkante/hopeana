// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// User model - stores user info like email and other social login details
model User {
  id            String    @id @default(cuid())
  email         String    @unique
  firstName     String?
  lastName      String?
  passwordHash  String?

  // Social login fields
  provider      String?   // e.g., "google", "github", "email"
  providerId    String?   // ID from the social provider

  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  // Relations
  schedules     Schedule[]
  sentMessages  SentMessage[]
  subscription  Subscription?

  @@index([email])
  @@index([provider, providerId])
}

// Schedule model - each user can create multiple schedules for receiving messages
model Schedule {
  id          String    @id @default(cuid())
  userId      String

  // Schedule configuration
  channel       String    // e.g., "email", "sms", "push"
  frequency     String    // e.g., "specific_days", "custom_interval"
  timeOfDay     String?   // e.g., "morning", "afternoon", "evening"
  timezone      String?   // user's timezone for scheduling
  daysOfWeek    String[]  // e.g., ["monday", "wednesday", "friday"]
  intervalValue Int?      // interval number (e.g., 2)
  intervalUnit  String?   // interval unit (e.g., "days", "weeks")
  isActive      Boolean   @default(true)

  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  // Relations
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  sentMessages SentMessage[]

  @@index([userId])
  @@index([isActive])
}

// SentMessage model - tracks messages sent by the server
model SentMessage {
  id          String    @id @default(cuid())
  userId      String
  scheduleId  String
  quoteId     String

  // Message tracking
  sentAt      DateTime  @default(now())
  channel     String    // channel through which the message was sent
  status      String    @default("sent") // "sent", "delivered", "failed"

  // Relations
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  schedule    Schedule  @relation(fields: [scheduleId], references: [id], onDelete: Cascade)
  quote       QuotesBank @relation(fields: [quoteId], references: [id])

  @@index([userId])
  @@index([scheduleId])
  @@index([sentAt])
}

// Subscription model - tracks user plan and message usage
model Subscription {
  id            String    @id @default(cuid())
  userId        String    @unique
  plan          String    @default("free")    // "free" | "pro"
  status        String    @default("active")  // "active" | "cancelled" | "expired"
  messageLimit  Int       @default(5)         // free=5 (trial), pro=30
  messagesUsed  Int       @default(0)
  billingDate   DateTime?                     // next billing date (pro only)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  // Relations
  user          User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([status])
}

// QuotesBank model - holds all motivational quotes that can be sent to users
model QuotesBank {
  id          String    @id @default(cuid())
  content     String    // The actual quote text
  author      String?   // Attribution to the quote author
  category    String?   // Category for filtering (e.g., "motivation", "success", "gratitude")

  isActive    Boolean   @default(true) // Whether this quote is available for sending

  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  // Relations
  sentMessages SentMessage[]

  @@index([category])
  @@index([isActive])
}
